<!DOCTYPE>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no">
	<meta content="telephone=no" name="format-detection">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link href="assets/stylesheets/main.css" rel="stylesheet" type="text/css" />
	<script language="javascript" type="text/javascript" src="assets/javascript/size.js"></script>
	<title>想买</title>
</head>
<body>
	<div class="cxtoppart cxtoppart_fixed histoppart">
		<div class="topseatch" id="J_ts">
			<a href="javascript:;" class="ts_back ts_back_b" id="J_back"></a>
			<a href="javascript:;" class="ts_screen ts_wscreen" id="J_ts_screen"></a>
			<a href="javascript:;" class="ts_cal" id="J_ts_sou">搜索</a>
			<p class="ts_til">最新拍品</p>
			<!-- <p class="inbox"><input type="text" class="ts_ctrol" name="" id="J_key" placeholder="商品名或编号"></p> -->
		</div>
	</div>
	<div class="html buylist buylist_new">
		<div class="goodlist goodcel" id="J_goodlist">
			

			<!-- 搜索无结果效果 -->
			<div class="empty"><p><img src="/assets/images/empty.png" class="emimg"></p><p class="emtext">暂无搜索结果</p></div>
		</div>
		<!-- <p class="botmore" id="J_botmore"><img src="assets/images/loading.gif" class="bmimg"><span id="J_moretext">正在加载更多···</span></p> -->
	</div>
	<div class="bl_botline">
		<a href="buylist.html" class="ls ls_active"><p class="ls_ico ls_icoa"></p>想收</a>
		<a href="mine.html" class="ls"><p class="ls_ico ls_icob"></p>我的</a>
	</div>
	
	<!-- 筛选数据弹层 -->
	<div class="pop dsn" id="J_pop_screen">
		<a href="javascript:;" class="J_popclose close" data-target="#J_pop_screen"></a>
		<div class="pop_rightcont pop_r_screen" id="J_xxx">
			<div class="pop_r_screenbox">
				<div class="prsitem">
					<p class="prsi_til">品牌<span class="J_screen_show prsi_tr" id="J_name_pinpai"></span></p>
					<p class="prsi_lses" id="J_sls_pinpai">
						<!-- data-key: screen的键值  data-value：键值对应的值 -->
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="pinpai" data-value="1" data-text="CHANEL/香水贵的01">CHANEL/香水贵的01</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="pinpai" data-value="2" data-text="CHANEL/香水贵的02">CHANEL/香水贵的02</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="pinpai" data-value="3" data-text="CHANEL/香水贵的03">CHANEL/香水贵的03</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="pinpai" data-value="4" data-text="CHANEL/香水贵的04">CHANEL/香水贵的04</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="pinpai" data-value="5" data-text="CHANEL/香水贵的05">CHANEL/香水贵的05</a>
						<a href="javascript:;" data-target="#J_pop_pinpai" class="J_pop_sls prsi_ls prsi_ls_more">全部品牌<img src="assets/images/arw_right.png" class="prsi_ar"></a>
					</p>
				</div>
				<div class="prsitem">
					<p class="prsi_til">分类<span class="J_screen_show prsi_tr" id="J_name_type"></span></p>
					<p class="prsi_lses">
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="type" data-value="" data-text="全部">全部</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="type" data-value="2" data-text="单肩包">单肩包</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="type" data-value="3" data-text="双肩包">双肩包</a>
						<a href="javascript:;" class="J_select J_kuang prsi_ls" data-key="type" data-value="4" data-text="链条包">链条包</a>
					</p>
				</div>
			</div>
			<p class="botbtns"><a href="javascript:;" class="bbtn" id="J_sc_reset">重置</a><a href="javascript:;" class="bbtn" id="J_sc_sure">确定</a></p>
		</div>
	</div>

	<!-- 二级全部品牌弹框 -->
	<div class="pop dsn" id="J_pop_pinpai">
		<a href="javascript:;" class="J_popclose close" data-target="#J_pop_pinpai"></a>
		<div class="pop_rightcont pop_rightcont_pp">
			<p class="soupp">
				<input type="text" class="ctrol" placeholder="请输入品牌关键词" id="J_keypp" name="">
				<a href="javascript:;" class="soupp_btn" id="J_soupp_btn">搜过</a>
			</p>
			<div class="pplist" id="J_pplist">
			</div>
		</div>
	</div>

	<script type="text/javascript">
		// app背景颜色设置
		// callapp('bg')
	</script>
	<script language="javascript" type="text/javascript" src="assets/javascript/jquery-2.1.4.min.js"></script>
	<script language="javascript" type="text/javascript" src="assets/javascript/func.js"></script>
	<script type="text/javascript">
		$(function(){

			// 关键字搜索处理相关js
			var J_ts = $('#J_ts'),
				J_ts_screen = $('#J_ts_screen');


			var screen = {}; // 预定义筛选对象，可根据需求更改结构或名称


			//关闭弹层
			$('.J_popclose').click(function(){
				$($(this).attr('data-target')).hide().removeClass('pop_active');
			});
			function closepop(tar){
				$(tar).hide().removeClass('pop_active');
			};
			//展开弹层
			function showpop(id){
				var tar = $(id);
				tar.show();
				setTimeout(function(){
					tar.addClass('pop_active');
				},20);
			};


			// 筛选部分js
			J_ts_screen.click(function(){
				showpop('#J_pop_screen');
			});

			$('.J_kuang').click(function(){
				$(this).addClass('prsi_ls_ac').siblings().removeClass('prsi_ls_ac');
			});

			$('#J_sc_reset').click(function(){
				screen = {}; // 重置screen筛选对象
				$('.J_screen_show').html('')
				$('.prsi_ls_ac').removeClass('prsi_ls_ac');
			});
			$('#J_sc_sure').click(function(){
				// 修改screen的对象值可在页面中对应的位置处理
				alert('筛选后的数据：'+JSON.stringify(screen));
				closepop('#J_pop_screen')
			});

			$('.J_select').click(function(){
				var self = $(this),
					k = self.attr('data-key'),
					v = self.attr('data-value'),
					t = self.attr('data-text'),
					sn = $('#J_name_'+k);
				screen[k] = v;
				if(sn) sn.html(t);
			});
			$('.J_pop_sls').click(function(){
				var tar = $($(this).attr('data-target'));
				tar.show();
				setTimeout(function(){
					tar.addClass('pop_active');
				},20);
			});

			$('#J_pplist').on('click','.J_tpai',function(){
				$('#J_sls_pinpai').find('.prsi_ls_ac').removeClass('prsi_ls_ac');
				var self = $(this),
					k = self.attr('data-key'),
					v = self.attr('data-value'),
					t = self.attr('data-text'),
					sn = $('#J_name_'+k);;
				screen[k] = v;
				if(sn) sn.html(t);
				closepop('#J_pop_pinpai');
			});

			// 品牌滚动加载 品牌搜索加载
			var pkey = '', // 预定义品牌搜索关键词
				ppdata = {'page':1,"pagesize":50}, // 品牌搜索分页
				J_pplist = $('#J_pplist');

			// 注册品牌滚动事件
			var dbs = new dombotmore('J_pplist',300,function(){
				console.log(123)
				ppdata.data++;
				getppajax();
			});

			$('#J_soupp_btn').click(function(){
				var v = $('#J_keypp').val().trim();
				if(v!=pkey){ // 更新关键字
					pkey = v;
					alert('关键字更新：'+v);
					getppajax(true);
				};
			});

			// 获取品牌列表
			function getppajax(first){
				if(first){
					J_pplist.html(''); //清空列表
				};
				// ajax获取列表数据
				isajax = true;
				dbs.stop = true; // 关闭下拉加载
				// alert('根据页面预定义的数据组合需要的数据提交');
				$.ajax({ 
					type: "GET",
					url: "api/five.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						isajax =false;
						if(res.code){
							// ***********此处获取数据 ruby渲染页面*****************
							// 以下是js虚拟dom渲染，后端嵌套时需调整-------start---
							var dt = res.data,len = dt.length,str = '';
							for(var i=0;i<len;i++){
								str += '<a href="javascript:;" class="J_tpai rline" data-value="10" data-key="pinpai" data-text="CHANEL/香水贵的010">CHANEL/香水贵的010</a>';
							};
							
							J_pplist.append(str);
							setTimeout(function(){
								dbs.stop = false; // 打开下拉加载
								// console.log(len<ppdata.pagesize,len,ppdata.pagesize)
								if(len<ppdata.pagesize){// 判断返回数据是否是全部数据
									dbs.stop = true; // 关闭下拉加载
								};
							},30);
							//----------end--------
						}else{
							CUES.alert({"msg":"此处可设置提示错误信息"})
						};
					}
				});
			};


			// 列表相关的js可在别的页面直接赋值就可以了，方便我这边写页面效果
			// 列表加载
			var data = {"page":0,"pagesize":10},
				isajax = false;//设置开关 防止重复提交;

			var J_goodlist = $('#J_goodlist'),
				J_botmore = $('#J_botmore'),
				J_moretext = $('#J_moretext');

			// 注册下拉滚动效果
			var bm = new botmore(240,function(){
				data.page++;
				getajax();
			});

			// 获取列表数据
			// alert('开发时需打开下方首页请求，前端暂时为了页面效果，首屏数据默认')
			// getajax(true);
			function getajax(first){
				if(first){
					J_goodlist.html(''); //清空列表
				};
				// ajax获取列表数据
				isajax = true;
				bm.stop = true; // 关闭下拉加载
				J_moretext.html("正在加载···");
				// alert('根据页面预定义的数据组合需要的数据提交');
				$.ajax({ 
					type: "GET",
					url: "api/search.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						isajax =false;
						if(res.code){
							// ***********此处获取数据 ruby渲染页面*****************
							// 以下是js虚拟dom渲染，后端嵌套时需调整-------start---
							var dt = res.data,len = dt.length,str = '';
							for(var i=0;i<len;i++){
								str += '<a href="buy_detail.html?pid=2" class="gitem">\
									<p class="gitem_imgbox"><img src="http://7ximo5.com1.z0.glb.clouddn.com/Fg-oMApnS2aK0P1HNkLWxoUhxCx6?imageView2/1/w/260/h/260" class="gitem_img"><span class="gitem_btime">距结束<span class="J_backtime gitem_bmn" data-starttime="1514596320000" data-endtime="1514607120000">00:00:00</span></span></p>\
									<div class="gitem_top">\
										<p class="gitem_title">钱包蔻驰(COACH)牛皮高贵女士皮靴啊牛皮高贵女士皮靴啊</p>\
										<p class="gitem_tps"><span class="gitem_tp">NO.46578954</span></p>\
										<p class="gitem_tps">成色:<span class="gitem_tp">九成新</span></p>\
										<p class="gitem_tbs"><span class="gitem_tb">超高性价比</span><span class="gitem_tb">绝对舒服柔软</span><span class="gitem_tb">绝对舒服柔软</span></p>\
									</div>\
								</a>';
							};
							
							J_goodlist.append(str);
							setTimeout(function(){
								bm.stop = false; // 打开下拉加载
								if(len<data.pagesize){// 判断返回数据是否是全部数据
									J_botmore.html("数据已全部加载完毕");
									bm.stop = true; // 关闭下拉加载
								};
								// 初始化倒计时
								backtimeelm();
							},30);
							//----------end--------
						}else{
							CUES.alert({"msg":"此处可设置提示错误信息"})
						};
					}
				});
			};

			function backtimeelm(){
				var J_backtime = $('.J_backtime'),
					len = J_backtime.length;
				for(var i=0;i<len;i++){
					var el = J_backtime.eq(i);
					if(el.attr('data-back')!='1'){
						backtime(el);
						el.attr({'data-back':1});
					}
				}
			}
			function backtime(elm){
				var st = new Date(parseInt(elm.attr('data-starttime'))),
					et = new Date(parseInt(elm.attr('data-endtime')));
				st =st.getTime();
				et = et.getTime();
				var timer = '';
				timer = setInterval(function(){
					if(st<=et){
						st+=1000;
						elm.html(inittime(Math.floor((et-st)/1000)));
					}else{
						clearInterval(timer);
						elm.html('已结束');
					}
				},1000);
			};
			function inittime(time){
				var h = Math.floor(time/3600),
					m = Math.floor((time%3600)/60);
					s = Math.floor(time%60);
			    return (h<10?'0'+h:h)+':'+(m<10?'0'+m:m)+':'+(s<10?'0'+s:s);
			};
			// 初始化倒计时，当页面加载新的数据后重新调用倒计时函数
			backtimeelm();


		});
	</script>
</body>
</html>
